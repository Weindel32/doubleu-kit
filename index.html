<!doctype html>
<html lang="it" translate="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DOUBLEU Kit Builder PRO</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0b1220">

<style>
:root{
--bg:#0b1220;
--card:#111a30;
--accent:#6ee7ff;
--text:#eaf0ff;
--muted:#94a3b8;
--good:#34d399;
--bad:#fb7185;
}

body{
margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:linear-gradient(180deg,#070b14,#0b1220);
color:var(--text);
}

.wrap{max-width:1200px;margin:auto;padding:16px}

h1{font-size:20px;margin:0 0 12px}

.grid{display:grid;grid-template-columns:1.3fr .9fr;gap:14px}
.card{
background:var(--card);
border-radius:18px;
padding:14px;
box-shadow:0 10px 30px rgba(0,0,0,.4);
}

label{font-size:12px;color:var(--muted)}
input,select{
width:100%;
padding:12px;
margin-top:6px;
border-radius:12px;
border:1px solid #25304f;
background:#0f172a;
color:white;
font-size:18px;
}

.row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}

button{
border:none;
padding:12px;
border-radius:12px;
font-weight:700;
cursor:pointer;
background:linear-gradient(90deg,#6ee7ff,#a78bfa);
color:#001;
}

button.secondary{
background:#1f2a44;
color:#fff;
}

.table{width:100%;margin-top:10px;border-collapse:collapse}
.table td{padding:6px}

.qtybox{display:flex;gap:6px;align-items:center}
.qbtn{
width:34px;height:34px;border-radius:10px;
background:#1f2a44;color:#fff;border:none;font-weight:900
}

.kpis{display:flex;flex-direction:column;gap:10px}
.kpi{
background:#0f172a;
border-radius:14px;
padding:14px;
}
.kpi .lbl{font-size:12px;color:var(--muted)}
.kpi .val{font-size:28px;font-weight:900}

.kpiGrid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px;
margin-top:14px
}

</style>
</head>
<body>
<div class="wrap">

<h1>DOUBLEU Kit Builder PRO</h1>

<div class="grid">

<div class="card">

<label>Numero atleti</label>
<input id="players" placeholder="es. 80">

<div class="row">
<div>
<label>Margine</label>
<select id="margin">
<option value="0.45">Minimal 45%</option>
<option value="0.50" selected>Standard 50%</option>
<option value="0.55">Premium 55%</option>
<option value="0.65">Online 65%</option>
<option value="0.72">Limited 72%</option>
<option value="0.75">Drop 75%</option>
</select>
</div>

<div>
<label>IVA %</label>
<input id="vat" value="22">
</div>

<div>
<label>Sconto %</label>
<input id="discount" value="0">
</div>
</div>

<div style="margin-top:10px">
<button onclick="applyPlayers()">Usa numero atleti</button>
<button class="secondary" onclick="resetAll()">Nuovo preventivo</button>
</div>

<h3 style="margin-top:18px">Articoli</h3>
<table class="table">
<tbody id="items"></tbody>
</table>
<button onclick="addItem()">+ Aggiungi articolo</button>

</div>

<div class="card">
<div class="kpis">
<div class="kpi"><div class="lbl">Costo atleta</div><div class="val" id="kCost">-</div></div>
<div class="kpi"><div class="lbl">Prezzo atleta</div><div class="val" id="kPrice">-</div></div>
<div class="kpi"><div class="lbl">Margine reale</div><div class="val" id="kMargin">-</div></div>
</div>
</div>

</div>

<div class="card">
<h3>Riepilogo ordine</h3>
<div class="kpiGrid">
<div class="kpi"><div class="lbl">Costo totale</div><div class="val" id="kTotal">-</div></div>
<div class="kpi"><div class="lbl">Fatturato</div><div class="val" id="kRevenue">-</div></div>
<div class="kpi"><div class="lbl">Utile</div><div class="val" id="kProfit">-</div></div>
<div class="kpi"><div class="lbl">Prezzo minimo</div><div class="val" id="kMin">-</div></div>
</div>
</div>
<script>

const toNum = v => {
  if(v === "" || v === null || v === undefined) return 0;
  return parseFloat(String(v).replace(",", ".")) || 0;
};

const COST_PREMIUM = {
"T-shirt":15,"Pantaloncino":16,"Sweatshirt":28,"Pantalone":26
};
const COST_BASIC = {
"T-shirt":9,"Pantaloncino":10.5,"Sweatshirt":19,"Pantalone":18
};
const COST_PROMOTIONAL = {
"T-shirt":8,"Pantaloncino":9,"Sweatshirt":16,"Pantalone":15
};

let items=[];

function newItem(){
return {name:"T-shirt",line:"PREMIUM",base:15,extra:0,qty:toNum(players.value)||0};
}

function addItem(){items.push(newItem());renderItems();}

function applyPlayers(){
let p=toNum(players.value);
items.forEach(it=>it.qty=p);
renderItems();
}

function resetAll(){
players.value="";
items=[newItem()];
renderItems();
}

function autoCost(i){
const it=items[i];
if(it.line=="PREMIUM") it.base=COST_PREMIUM[it.name]||it.base;
if(it.line=="BASIC") it.base=COST_BASIC[it.name]||it.base;
if(it.line=="PROMOTIONAL") it.base=COST_PROMOTIONAL[it.name]||it.base;
}

function renderItems(){
let html="";
items.forEach((it,i)=>{
html+=`
<tr>

<td>
<select onchange="items[${i}].name=this.value;autoCost(${i});renderItems()">
<option ${it.name=="T-shirt"?"selected":""}>T-shirt</option>
<option ${it.name=="Pantaloncino"?"selected":""}>Pantaloncino</option>
<option ${it.name=="Sweatshirt"?"selected":""}>Sweatshirt</option>
<option ${it.name=="Pantalone"?"selected":""}>Pantalone</option>
</select>
</td>

<td>
<select onchange="items[${i}].line=this.value;autoCost(${i});renderItems()">
<option ${it.line=="PREMIUM"?"selected":""}>PREMIUM</option>
<option ${it.line=="BASIC"?"selected":""}>BASIC</option>
<option ${it.line=="PROMOTIONAL"?"selected":""}>PROMOTIONAL</option>
<option ${it.line=="ALTRO"?"selected":""}>ALTRO</option>
</select>
</td>

<td><input value="${it.base}" oninput="items[${i}].base=toNum(this.value);calc()"></td>
<td><input value="${it.extra}" oninput="items[${i}].extra=toNum(this.value);calc()"></td>

<td>
<div class="qtybox">
<button class="qbtn" onclick="items[${i}].qty=Math.max(0,items[${i}].qty-1);renderItems()">-</button>
<input value="${it.qty}" oninput="items[${i}].qty=toNum(this.value);calc()">
<button class="qbtn" onclick="items[${i}].qty++;renderItems()">+</button>
<button class="qbtn" onclick="items.splice(${i}+1,0,{...items[${i}]});renderItems()">⧉</button>
</div>
</td>

<td><button onclick="items.splice(${i},1);renderItems()">✕</button></td>

</tr>`;
});
document.getElementById("items").innerHTML=html;
calc();
}

</script>
<script>

function eur(v){
return (v||0).toFixed(2)+"€";
}

function calc(){

let playersN = toNum(players.value) || 1;
let margin = parseFloat(marginEl.value);
let vat = toNum(vatEl.value)/100;
let discount = toNum(discountEl.value)/100;

let totalCost = 0;

items.forEach(it=>{
totalCost += (toNum(it.base)+toNum(it.extra))*toNum(it.qty);
});

let netTarget = totalCost/(1-margin);
let gross = netTarget*(1+vat);
gross *= (1-discount);

let netFinal = gross/(1+vat);
let realMargin = (netFinal-totalCost)/netFinal;

let minPrice = gross/playersN;
let priceAthlete = gross/playersN;
let costAthlete = totalCost/playersN;
let profit = netFinal-totalCost;

/* KPI TOP */
kCost.innerText = eur(costAthlete);
kPrice.innerText = eur(priceAthlete);
kMargin.innerText = (realMargin*100).toFixed(1)+"%";

/* RIEPILOGO */
kTotal.innerText = eur(totalCost);
kRevenue.innerText = eur(gross);
kProfit.innerText = eur(profit);
kMin.innerText = eur(minPrice);

}

/* elementi */
const players=document.getElementById("players");
const marginEl=document.getElementById("margin");
const vatEl=document.getElementById("vat");
const discountEl=document.getElementById("discount");

players.addEventListener("input",calc);
marginEl.addEventListener("change",calc);
vatEl.addEventListener("input",calc);
discountEl.addEventListener("input",calc);

/* start */
items=[newItem()];
renderItems();

</script>
</body>
</html>
